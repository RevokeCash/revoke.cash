import Divider from 'components/common/Divider';
import Prose from 'components/common/Prose';
import ExploitCard from 'components/exploits/ExploitCard';
import ReportExploitButton from 'components/exploits/ReportExploitButton';
import PublicLayout from 'layouts/PublicLayout';
import { defaultSEO } from 'lib/next-seo.config';
import { Exploit, getAllExploits } from 'lib/utils/exploits';
import { GetStaticProps, NextPage } from 'next';
import { NextSeo } from 'next-seo';
import useTranslation from 'next-translate/useTranslation';

interface Props {
  exploits: Exploit[];
}

const ExploitOverviewPage: NextPage<Props> = (props) => {
  const { t } = useTranslation();

  const totalAmount = `$${Math.floor(props.exploits.reduce((prev, curr) => prev + curr.amount, 0))}M`;
  const earliestYear = props.exploits.at(-1).date.slice(0, 4);

  return (
    <>
      <NextSeo
        {...defaultSEO}
        title={t('exploits:meta.title')}
        description={t('exploits:meta.description', { totalAmount, earliestYear })}
        openGraph={{
          ...defaultSEO,
          images: [{ url: `https://revoke.cash/assets/images/exploits/cover.jpg`, width: 1600, height: 900 }],
        }}
      />

      <PublicLayout>
        <div className="flex flex-col gap-4 max-w-3xl mx-auto">
          <div className="flex sm:flex-row flex-wrap gap-2 items-center justify-between not-prose">
            <div>
              <h1 className="mb-1">{t('exploits:title')}</h1>
              <p>{t('exploits:subtitle', { totalAmount, earliestYear })}</p>
            </div>
            <ReportExploitButton />
          </div>
          <Divider />
          <Prose>
            <p>{t('exploits:description')}</p>
          </Prose>
          {props.exploits.map((exploit) => (
            <ExploitCard key={exploit.slug} exploit={exploit} overview />
          ))}
        </div>
      </PublicLayout>
    </>
  );
};

export const getStaticProps: GetStaticProps<Props> = async () => {
  const exploits = await getAllExploits();

  return {
    props: {
      exploits,
    },
  };
};

export default ExploitOverviewPage;
