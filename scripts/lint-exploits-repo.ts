import { utils } from 'ethers';
import fs from 'fs/promises';
import path from 'path';

const passedPath = process.argv[2];
const exploitRepoPath = passedPath;

const lintChecksums = async () => {
  const exploits = await fs.readdir(exploitRepoPath);

  await Promise.all(
    exploits.map(async (fn) => {
      const exploitPath = path.join(exploitRepoPath, fn);
      const exploitContents = await fs.readFile(exploitPath, 'utf-8');
      const exploitJson = JSON.parse(exploitContents);
      const lintedAddresses = exploitJson.addresses.map(({ chainId, address }) => ({
        chainId,
        address: utils.getAddress(address.toLowerCase()),
      }));
      const lintedExploitJson = {
        ...exploitJson,
        addresses: lintedAddresses,
      };

      await fs.writeFile(exploitPath, JSON.stringify(lintedExploitJson, null, 2));
    })
  );
};

lintChecksums();
