import { ShieldExclamationIcon } from '@heroicons/react/24/outline';
import Card from 'components/common/Card';
import ChainLogo from 'components/common/ChainLogo';
import Href from 'components/common/Href';
import { Exploit, getUniqueChainIds } from 'lib/utils/allowance-exploit-list';
import { ReactNode } from 'react';

interface Props {
  exploit: Exploit;
  compact?: boolean;
}

const ExploitCard = (props: Props) => {
  return (
    <Card icon={ShieldExclamationIcon} title={props.exploit.name} className="flex flex-col gap-4 ">
      <table className="table-auto">
        <tbody className="divide-y">
          <tr>
            <td className="py-1 w-36">Discovered On</td>
            <td className="py-1">{new Date(props.exploit.date).toLocaleDateString()}</td>
          </tr>
          <tr>
            <td className="py-1 w-36">Amount Stolen</td>
            <td className="py-1">${props.exploit.amount}M</td>
          </tr>
          <tr>
            <td className="py-1">Affected Chains</td>
            <td className="py-1 flex gap-2 flex-wrap">
              {getUniqueChainIds(props.exploit).map((chainId, index) => (
                <ChainLogo tooltip chainId={chainId} key={index} />
              ))}
            </td>
          </tr>
          {!props.compact && (
            <tr>
              <td className="py-1">Read More</td>
              <td className="py-1">
                {props.exploit.metaArticleUrls
                  .map<ReactNode>((article) => (
                    <Href key={article} href={article} underline="hover" className="font-medium">
                      {new URL(article).hostname}
                    </Href>
                  ))
                  .reduce((prev, curr) => [prev, ', ', curr])}
              </td>
            </tr>
          )}
        </tbody>
      </table>

      <div>
        <h4>About</h4>
        <p>{props.exploit.description}</p>
      </div>
    </Card>
  );
};

export default ExploitCard;
